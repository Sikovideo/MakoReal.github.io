<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アカウント作成 - MakoReal</title>
    <style>
        /* スタイルは省略 */
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage.js"></script>
</head>
<body>

<div class="container">
    <header>MakoReal.</header>
    <form id="signup-form">
        <label for="username">名前</label>
        <input type="text" id="username" name="username" required>
        
        <label for="email">メールアドレス</label>
        <input type="email" id="email" name="email" required>
        
        <label for="password">パスワード</label>
        <input type="password" id="password" name="password" required>
        
        <label for="icon">アイコン</label>
        <input type="file" id="icon" accept="image/*" required>
        
        <button type="submit">アカウント作成</button>
    </form>
    <div class="link">
        アカウントをすでに持っていますか？ <a href="roguin.html">ログイン</a>.
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBNwcRVa1Ip_3ZX3qjxkbwd-ViScS3lbEg",
        authDomain: "makoreal.firebaseapp.com",
        projectId: "makoreal",
        storageBucket: "makoreal.appspot.com",
        messagingSenderId: "1063358529065",
        appId: "1:1063358529065:web:e7f2da6177516a71926638",
        measurementId: "G-K35J2B3QJT"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const storage = getStorage(app);

    document.getElementById('signup-form').addEventListener('submit', function(event) {
        event.preventDefault();

        const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const iconFile = document.getElementById('icon').files[0];

        createUserWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
                const user = userCredential.user;

                // アイコンのアップロード
                const storageRef = ref(storage, `users/${user.uid}/icon.jpg`);
                return uploadBytes(storageRef, iconFile)
                    .then(() => getDownloadURL(storageRef))
                    .then((iconUrl) => {
                        // プロフィールを更新
                        return updateProfile(user, {
                            displayName: username,
                            photoURL: iconUrl
                        });
                    });
            })
            .then(() => {
                // ログイン後にMakoReal.htmlにリダイレクト
                window.location.href = 'MakoReal.html';
            })
            .catch((error) => {
                alert('エラー: ' + error.message);
            });
    });
</script>

</body>
</html>
